<!DOCTYPE html>
<html>
<head>
<title>Ventas</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body class="bg-light">

<div class="container-fluid mt-4">

<h3 class="mb-3">ðŸ“‹ CRUD Ventas (Admin)</h3>
<a href="/" class="btn btn-secondary mt-3">â¬… Volver</a>


<div class="table-responsive">
<form method="GET" class="row mb-3">

<div class="col-md-3">
<select name="campo" class="form-select">
<option value="cliente" {% if campo=="cliente" %}selected{% endif %}>Cliente</option>
<option value="servicio" {% if campo=="servicio" %}selected{% endif %}>Servicio</option>
<option value="trabajadora" {% if campo=="trabajadora" %}selected{% endif %}>Trabajadora</option>
<option value="dni" {% if campo=="dni" %}selected{% endif %}>DNI</option>
<option value="telefono" {% if campo=="telefono" %}selected{% endif %}>TelÃ©fono</option>
</select>
</div>

<div class="col-md-4">
<input type="text" name="q" class="form-control"
       value="{{ q or '' }}"
       placeholder="Buscar...">
</div>

<div class="col-md-3 d-flex gap-2">

<button class="btn btn-primary w-50">Buscar</button>

<a href="/ventas" class="btn btn-secondary w-50">
Limpiar
</a>

</div>

</form>

<table class="table table-sm table-bordered table-hover align-middle text-center">

<thead class="table-dark">
<tr>
<th>Fecha</th>
<th>Servicio</th>
<th>Precio</th>
<th>Cliente</th>
<th>Trabajadora</th>
<th>Pago</th>
<th>DNI</th>
<th>TelÃ©fono</th>
<th>Obs</th>
<th>Acciones</th>
</tr>
</thead>

<tbody>

{% for v in ventas.items %}
<tr>

<form method="POST" action="/ventas/editar/{{v.id}}">

<td style="min-width:120px">
<input type="date" class="form-control form-control-sm"
       name="fecha"
       value="{{ v.fecha.strftime('%Y-%m-%d') }}">
</td>

<td style="min-width:200px">
<select class="form-select form-select-sm" name="servicio">
{% for s in servicios %}
<option value="{{s.id}}" {% if s.id==v.servicio_id %}selected{% endif %}>
{{s.nombre}}
</option>
{% endfor %}
</select>
</td>

<td style="min-width:90px">
<input class="form-control form-control-sm text-end fw-bold"
       name="precio"
       value="{{v.precio}}">
</td>

<td style="min-width:150px">
<input class="form-control form-control-sm"
       name="cliente"
       value="{{v.cliente or ''}}">
</td>

<td style="min-width:120px">
<select class="form-select form-select-sm" name="trabajadora">
{% for t in trabajadoras %}
<option value="{{t.id}}" {% if t.id==v.trabajadora_id %}selected{% endif %}>
{{t.nombre}}
</option>
{% endfor %}
</select>
</td>

<td>
<select class="form-select form-select-sm" name="medio_pago">
<option {% if v.medio_pago=="Yape" %}selected{% endif %}>Yape</option>
<option {% if v.medio_pago=="Plin" %}selected{% endif %}>Plin</option>
<option {% if v.medio_pago=="Efectivo" %}selected{% endif %}>Efectivo</option>
<option {% if v.medio_pago=="Tarjeta" %}selected{% endif %}>Tarjeta</option>
<option {% if v.medio_pago=="Transferencia" %}selected{% endif %}>Transferencia</option>
</select>
</td>

<td>
<input class="form-control form-control-sm"
       name="dni"
       value="{{ v.dni|int if v.dni }}">
</td>

<td>
<input class="form-control form-control-sm"
       name="telefono"
       value="{{ v.telefono|int if v.telefono }}">
</td>

<td style="min-width:150px">
<input class="form-control form-control-sm"
       name="observaciones"
       value="{{v.observaciones or ''}}">
</td>

<td style="min-width:120px">

<button class="btn btn-success btn-sm"
        type="submit"
        onclick="return confirm('Â¿Guardar cambios de esta venta?')">
ðŸ’¾
</button>

<a href="/ventas/eliminar/{{v.id}}"
   class="btn btn-danger btn-sm"
   onclick="return confirm('Â¿Seguro que deseas eliminar esta venta?')">
ðŸ—‘
</a>

</td>

</form>

</tr>
{% endfor %}

</tbody>
</table>
<nav class="mt-3">
<ul class="pagination justify-content-center">

{% if ventas.has_prev %}
<li class="page-item">
<a class="page-link"
   href="{{ url_for('ventas', page=ventas.prev_num, campo=campo, q=q) }}">
Anterior
</a>
</li>
{% endif %}

{% for num in ventas.iter_pages() %}
  {% if num %}
    <li class="page-item {% if ventas.page == num %}active{% endif %}">
      <a class="page-link"
         href="{{ url_for('ventas', page=num, campo=campo, q=q) }}">
         {{ num }}
      </a>
    </li>
  {% endif %}
{% endfor %}

{% if ventas.has_next %}
<li class="page-item">
<a class="page-link"
   href="{{ url_for('ventas', page=ventas.next_num, campo=campo, q=q) }}">
Siguiente
</a>
</li>
{% endif %}

</ul>
</nav>

</div>


</div>

</body>
</html>
