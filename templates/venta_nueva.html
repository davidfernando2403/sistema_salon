<!DOCTYPE html>
<html>

<head>
    <title>Nueva Venta</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
.table td, .table th {
    vertical-align: middle;
}

td {
    font-size: 14px;
}

td {
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
}
</style>

</head>

<body class="bg-light">

    <div class="container mt-4">

        <h3>âž• Registrar venta</h3>

        {% with messages = get_flashed_messages(with_categories=true) %}
    {% for c, m in messages %}
        <div class="alert alert-{{ c }}">{{ m }}</div>
    {% endfor %}
{% endwith %}

        <form method="POST" action="/ventas/guardar" class="row g-3">

            <div class="col-md-4">
                <input name="cliente" class="form-control" placeholder="Cliente" required>
            </div>

            <div class="col-md-3">
                <select name="servicio" class="form-control" required>
                    {% for s in servicios %}
                    <option value="{{s.id}}">{{s.nombre}}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <select name="trabajadora" class="form-control" required>
                    {% for t in trabajadoras %}
                    <option value="{{t.id}}">{{t.nombre}}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2">
                <input name="precio" type="number" step="0.01" class="form-control" placeholder="Precio" required>
            </div>

            <div class="col-md-3">
                <select name="medio_pago" class="form-control" required>
                    <option>Yape</option>
                    <option>Plin</option>
                    <option>Efectivo</option>
                    <option>Tarjeta</option>
                    <option>Transferencia</option>
                </select>
            </div>

            <div class="col-md-3">
                <input name="dni" class="form-control" placeholder="DNI (obligatorio)">
            </div>

            <div class="col-md-3">
                <input name="telefono" class="form-control" placeholder="TelÃ©fono">
            </div>

            <div class="col-md-12">
                <textarea name="observaciones" class="form-control" placeholder="Observaciones"></textarea>
            </div>

            <div class="col-md-12">
                <button class="btn btn-success w-100">Guardar venta</button>
            </div>

        </form>

        <div class="mt-3">
            <a href="/" class="btn btn-dark">â¬… Volver</a>
        </div>
        <hr>

        <h5 class="mt-4">ðŸ“‹ Ventas registradas</h5>

<div class="text-center mt-3">
    <a href="/ventas/historial" class="btn btn-outline-dark">
        ðŸ“‹ Ver historial completo
    </a>
    <hr>
</div>

        <table class="table table-striped table-hover align-middle">

            <thead class="table-dark">
                <tr>
                    <th>Fecha</th>
                    <th>Servicio</th>
                    <th>Cliente</th>
                    <th>Precio</th>
                    <th>Trabajadora</th>
                    <th>Pago</th>
                    <th>DNI</th>
                    <th>TelÃ©fono</th>
                    <th>Observaciones</th>
                </tr>
            </thead>

            <tbody>
                {% for v in ventas %}
                <tr>
                    <td>{{ v.fecha.strftime('%d/%m/%Y') if v.fecha }}</td>
                    <td>{{ v.servicio.nombre }}</td>
                    <td>{{ v.cliente }}</td>
                    <td class="text-nowrap">
                        S/ {{ "%.2f"|format(v.precio) }}
                    </td>

                    <td>{{ v.trabajadora.nombre }}</td>
                    <td>{{ v.medio_pago }}</td>
                    <td>
                        {% if v.dni %}
                        {{ v.dni|int }}
                        {% endif %}
                    </td>

                    <td>
                        {% if v.telefono %}
                        {{ v.telefono|int }}
                        {% endif %}
                    </td>

                    <td>{{ v.observaciones or '' }}</td>
                </tr>
                {% endfor %}
            </tbody>

        </table>


    </div>

</body>

</html>